# Enable rewrite engine
RewriteEngine On
Options +FollowSymLinks

# Handle PHP files
AddHandler application/x-httpd-php .php

# Set default character set
AddDefaultCharset UTF-8

# Security headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"

# Deny access to hidden files and directories
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

# Protect logs directory but allow PHP scripts to access it
<DirectoryMatch "^/logs/">
    <FilesMatch "\.log$">
        Order allow,deny
        Deny from all
    </FilesMatch>
</DirectoryMatch>

# If the request is for an actual file or directory, serve it directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Handle API requests - pass through to api/.htaccess
RewriteRule ^api/ - [L]

# PHP settings
php_flag display_errors off
php_value error_reporting E_ALL
php_flag log_errors on
php_value error_log logs/errors/php_error.log

# Ensure proper handling of JSON responses
AddType application/json .json
